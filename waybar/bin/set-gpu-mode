#!/bin/sh

GPU_MODE_CONFIG="$HOME/.config/waybar/etc/current-gpu-mode.conf"
CURRENT_GPU_MODE=$(cat "$GPU_MODE_CONFIG")

switch_gpu() {
    if sudo intel-nvidia-switch --switch "$1"; then
        echo "$1" | sudo sed -e "s/\b\(.\)/\u\1/g" > "$GPU_MODE_CONFIG"
        notify-send "GPU Changed" "$1"
        [ "$1" = "intel" ] && sed -i "\|source = ~/.config/hypr/hyprland/nvidia.conf|d" "$HOME/.config/hypr/hyprland.conf"
        sudo mkinitcpio -P
        restart_now
        systemctl reboot
    else
        notify-send "GPU Switch Error"
        return 1
    fi
}

if [ "$CURRENT_GPU_MODE" = "Hybrid" ]; then
    switch_gpu "intel"
else
    switch_gpu "hybrid"
fi

