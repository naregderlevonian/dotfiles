#!/bin/sh

DEFAULT_SOURCE=$(pactl get-default-source)
INFORMATION=$(pactl list sources | grep -A 16 "$DEFAULT_SOURCE")

DESCRIPTION=$(echo "$INFORMATION" | grep -oP '(?<=Description: ).*')
VOLUME=$(echo "$INFORMATION" | grep -oP '(?<=Volume:).*' | head -n 1 | grep -oP '[0-9]+%' | head -n 1)
IS_MUTED=$(echo "$INFORMATION" | grep -oP '(?<=Mute: ).*')
SAMPLE_RATE=$(echo "$INFORMATION" | grep -oP '(?<=Sample Specification: ).*' | grep -oP '[0-9]+Hz')
BUFFER_SIZE=$(echo "$INFORMATION" | grep -oP '(?<=api.alsa.period-size = ")[0-9]+')

LATENCY=$(echo "scale=5; $BUFFER_SIZE / ${SAMPLE_RATE%Hz} * 1000" | bc)

if [ -z "$INFORMATION" ]; then
    echo "No Sound "
    exit 0
fi

if [ "$DESCRIPTION" = "Monitor of Dummy Output" ]; then
    echo "No Input "
    exit 0
fi

if [ "$IS_MUTED" = "yes" ]; then
    echo "$DESCRIPTION Muted "
else
    echo "$DESCRIPTION $VOLUME, ${SAMPLE_RATE%Hz}Hz $BUFFER_SIZE $(printf "%.2f" $LATENCY)ms " | tr -s " "
fi

