#!/bin/sh

MODE=~/.config/hypr/hyprland/mode.conf
HYPERPAPER_CONFIG=~/.config/hypr/hyprpaper.conf

THEMES=(
    Default
    Night
)

# Function to get the current theme
get_current_theme() {
    if [ -s "$MODE" ]; then
        basename $(grep -oP '(?<=modes/).*(?=\.conf)' "$MODE")
    else
        echo "Default"
    fi
}

# Function to toggle themes
toggle_theme() {
    current_theme=$(get_current_theme)
    for i in "${!THEMES[@]}"; do
        if [ "${THEMES[$i]}" = "$current_theme" ]; then
            next_index=$(( (i + 1) % ${#THEMES[@]} ))
            new_theme=${THEMES[$next_index]}
            break
        fi
    done

    if [ "$new_theme" = "Default" ]; then
        > $MODE
        pkill hyprpaper
    else
        echo "source = ~/.config/hypr/hyprland/modes/$new_theme.conf" > $MODE
    fi

    notify-send "Theme: $new_theme"

    # Update hyprpaper config
    sed -i "s/$current_theme/$new_theme/g" $HYPERPAPER_CONFIG
    sed -i "s/$current_theme/$new_theme/g" $HYPERPAPER_CONFIG
}

if [ -s "$MODE" ]; then
    current_theme=$(get_current_theme)
    if [ "$current_theme" != "Default" ]; then
        toggle_theme
    else
        notify-send "Theme Off"
        > $MODE
    fi
else
    toggle_theme
fi

pkill hyprpaper
hyprctl reload
hyprpaper

